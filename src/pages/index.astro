---
import { getPosts } from "db/prisma/queries"
import { getUser } from "db/supabase/auth"
import Layout from "layouts/Layout.astro"
import Navigation from "components/Navigation"
import PostsList from "components/PostsList"


const [user, posts] = await Promise.all([getUser(Astro.request), getPosts(0, 10)])

if (!user) {
  return Astro.redirect("/auth")
}

---


<Layout>
  <Navigation username={user.username} />
  <PostsList userId={user.id} initPosts={posts} client:load />
</Layout>
