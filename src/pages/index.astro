---
import PostsList from "../components/PostsList"
import Layout from "../layouts/Layout.astro"
import { getPosts } from "../db/prisma/queries"
import { getUser } from "../db/supabase/auth"
import Navigation from "../components/Navigation"

const user = await getUser(Astro.request)

console.log(user)

if (!user) {
  return Astro.redirect("/auth")
}

const posts = await getPosts(0)

console.log("[index] load:")
posts.forEach((post) =>
  console.log(`\t${post.title}:${post.author}:${post.id}`)
)
---


<Layout>
  <Navigation username={user.username} />
  <PostsList posts={posts} userId={user.id} client:load />
</Layout>
